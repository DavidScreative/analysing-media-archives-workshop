<h2>Bucket Objects</h2>

<table>

    <thead>
        <tr>
            <td>Name</td>
            <td>Processed?</td>
            <td>Transcribed?</td>
            <td>Trigger Analysis</td>
        </tr>
    </thead>

    <tbody>
        {{#each item}}
        <tr>
            <td>{{this.Key}}</td>
            <td>{{#if this.exists}} Yes {{else}} No {{/if}} </td>
            <td>{{#if this.transcribed}} Yes {{else}} No {{/if}}</td>
            <td><a href="#" class="analysisTrigger" data-objectkey="{{this.Key}}">Analyse</a></td>
        </tr>
        {{/each}}
    </tbody>

</table>

<script>

    (function(){

        'use strict';

        const analyseButtons = Array.from(document.querySelectorAll('tbody td a.analysisTrigger'));

        analyseButtons.forEach(function(button){

            button.addEventListener('click', function(e){

                e.preventDefault();
                e.stopImmediatePropagation();

                fetch('/analyse/' + this.dataset.objectkey, {method : "POST"})
                    .then(function(res){
                        if(res.ok){
                            return res.json();
                        } else {
                            throw res;
                        }
                    })
                    .then(function(response){
                        console.log(response);
                    })
                    .catch(function(err){
                    })
                ;
                console.log(this.dataset.objectkey);

            }, false);

        })

    }());

</script>