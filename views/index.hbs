<h1>What would you like to search for?</h1>

<form id="search">

    <input type="text" placeholder="Enter terms, phrases and tags to search for..."/>
    <input type="submit" value="Search"/>

</form>

<div id="resultsContainer">
    <h2>Results</h2>

    <div id="resultsWrapper">
    
        <div id="frames" class="resultsList">
            <h3>Keyframes</h3>
            <ol>
                <li></li>
            </ol>
        </div>

        <div id="transcriptions" class="resultsList">
            <h3>Transcriptions</h3>
            <ol>
                <li></li>
            </ol>
        </div>
    
    </div>

</div>

<script>

    (function(){

        'use strict';

        const searchForm = document.querySelector('#search');
        const framesContainer = document.querySelector('#resultsContainer #frames');

        searchForm.addEventListener('submit', function(e){
            
            e.preventDefault();
            e.stopImmediatePropagation();

            console.log(this[0].value);

            fetch('/search', {
                    method : "POST",
                    headers : {
                        "Content-Type" : "application/json"
                    },
                    body : JSON.stringify( { searchTerm : this[0].value } )
                })
                .then(function(res){
                    if(res.ok){
                        return res.json();
                    } else {
                        throw res;
                    }
                })
                .then(function(response){
                    console.log(response);
                    const data = response.data;
                    
                    const framesList = framesContainer.querySelector('ol')
                    framesList.innerHTML = "";

                    Object.keys(data).forEach(key => {

                        const HTML = data[key].frames.map(frame => {
                            return `<li><img src="/keyframe/${frame.uuid}.jpg" /></li>`
                        }).join('');
                        framesList.innerHTML += HTML;
                    });

                })
                .catch(function(err){
                    console.log('Search err:', err);
                })

        }, false);

    }());

</script>